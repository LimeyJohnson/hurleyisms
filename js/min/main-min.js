$(document).ready(function(){function n(){var n=$("section.submit textarea"),e=n.attr("maxlength"),t=n.val().length,i=e-t,o=1>i;$("section.submit .char-remaining").text(i),$("section.submit label[for=the-line] .form-control__label-hint").toggleClass("error",o)}function e(n){var e=$("section."+n);e.hasClass("active")||($("section.active").removeClass("active"),e.addClass("active"))}function t(){$(".line-added").addClass("fade-in"),$("#the-line").val(""),i($("body"))}function i(n){$("html, body").animate({scrollTop:n.offset().top},250)}function o(){a(),r(),g(),v()}function a(){var n;O===A.MEN&&(n="men"),O===A.WOMEN&&(n="women"),O===A.KIDS&&(n="kids"),$("span.audience").text(n)}function r(){var n=s();b(n)}function s(){for(var n=l()?1:5,e=[],t=[],i=!1,o=$("main .line").first(),a=0;n>a;a++){for(var r;;)if(r=c(),u(r.id,t)){t.push(r.id),e.push(r);break}if(0===o.length&&(o=h()),d(r,o),i=f(o))break;o=o.next()}return e}function l(){return window.matchMedia("(max-width: 568px)").matches}function c(){var n=Math.floor(Math.random()*T.length);return T[n]}function u(n,e){return-1===e.indexOf(n)}function h(){return $("#lines .line:last-child").clone().appendTo("#lines")}function d(n,e){e.find(".line__text").html(n.line),e.find(".line__byline .author").text(n.author)}function f(n){return m(n)?(l()?p(n):n.remove(),!0):!1}function m(n){var e=n[0].getBoundingClientRect(),t=$(".lines__footer").height()+$("#progress-bar").height(),i=window.innerHeight-t;return e.bottom>i}function p(n){for(var e=n.children(".line__text").css("font-size"),t=parseInt(e,10);m(n);)t-=2,n.children(".line__text").css("font-size",t)}function b(n){I=n.map(function(n){return n.line.length}).reduce(function(n,e){return n+e})}function g(){W=$("input[type=range]").val()}function v(){D=requestAnimationFrame(w)}function y(){cancelAnimationFrame(D)}function k(){y(),M=null,E.width(0)}function w(n){var e=C(n);e>100&&(e=0,x());var t=e+"%";E.css("width",t),M=n,v()}function C(n){M||(M=n);var e=n-M,t=E.width()/N.width()*100,i=l()?1:3,o=i*W*e/I;return t+o}function x(){_(),P(),r(),i($("body"))}function _(){$(".thumbs-up.active, .thumbs-down.active").removeClass("active")}function P(){$("#lines .line__text").removeAttr("style")}function H(){k(),E.width(0),x(),$(".pause").hasClass("is-paused")||v()}var T=[{id:0,line:"Flare your right nostril...<br/><br/>Wait, you did both.  Just the right one.",men:!0,women:!0,kids:!0,profanity:!1,rating:0,author:"Peter Hurley"},{id:1,line:"Don't get ahead of yourselfâ€“ you'll get ahead of me!",men:!0,women:!0,kids:!0,profanity:!1,rating:0,author:"Peter Hurley"},{id:2,line:"Look like you WON the marathon.<br/><br/>Now look like you LOST the marathon.",men:!0,women:!0,kids:!1,profanity:!1,rating:0,author:"Peter Hurley"},{id:3,line:"Think like a pedestrian!",men:!0,women:!0,kids:!1,profanity:!1,rating:0,author:"Peter Hurley"},{id:4,line:"Look like you're operating from a different train of thought!",men:!0,women:!0,kids:!1,profanity:!1,rating:0,author:"Peter Hurley"},{id:5,line:"TWILCH to the left!...<br/><br/>Ahh, so THAT'S what a twilch is!",men:!0,women:!0,kids:!0,profanity:!1,rating:0,author:"Peter Hurley"},{id:6,line:"Smirch up a bit.  That's the PERFECT amount of smirch!<br/><br/>Now DOUBLE the smirch.  Ahh, smirchfection!",men:!0,women:!0,kids:!0,profanity:!1,rating:0,author:"Peter Hurley"},{id:7,line:"Forehead UP, chin DOWN, forehead UP, chin DOWN...<br/><br/>Why are you nodding?",men:!0,women:!0,kids:!0,profanity:!1,rating:0,author:"Peter Hurley"}],A={MEN:0,WOMEN:1,KIDS:2},N=$("#progress-bar"),E=$("#progress-bar__fill"),O,W,D,M,I;n(),$("a.begin-session").click(function(){O=Number($(this).attr("data-audience-type")),e("lines"),o()}),$(".switch").click(function(){$(this).toggleClass("active")}),$(".btn.add-line").click(function(){e("submit")}),$("section.submit a.close").click(function(){e("splash")}),$("section.submit textarea").keyup(function(){n()}),$("section.submit .add-line").click(function(){$(".error").remove();var n=" <span class='error'>Required</span>";if(""===$("#the-line").val()&&$("label[for=the-line]").append(n),0===$(".checkbox-list input:checked").length&&$(".form-control--audience .form-control__label").append(n),0===$(".error").length)t();else{var e=$(".error").first();i(e)}}),$("body").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(".line-added").removeClass("fade-in")}),$(window).on("swipeleft",function(){H()}),$("section.lines a.close").click(function(){e("splash"),k(),$(".pause").removeClass("is-paused")}),$(document).on("click",".thumbs-up, .thumbs-down",function(){$(this).toggleClass("active"),$(this).hasClass("active")&&$(this).siblings(".btn.active").removeClass("active")}),$("input[type=range]").change(function(){W=$(this).val()}),$(".pause").click(function(){$(this).toggleClass("is-paused"),$(this).hasClass("is-paused")?y():v()}),$(".next").click(function(){H()})}),$("#admin-table .btn:first-child").click(function(){$(this).toggleClass("active"),$(this).hasClass("active")?$(this).text("Approved"):$(this).text("Approve")}),$("#admin-table .btn:last-child").click(function(){window.confirm("Delete this line?  This cannot be undone.")}),$("#admin-table .ban-ip").click(function(){window.confirm("Ban this IP?  This will also delete all this IP's lines, and cannot be undone.")});