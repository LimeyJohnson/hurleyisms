var express=require("express"),router=express.Router(),mongoose=require("mongoose"),Lines=mongoose.model("Line"),banlist=mongoose.model("Banlist"),path=require("path");router.get("/",function(e,o,r){o.sendFile(path.join(__dirname,"../public","app.html"))}),router.get("/data/:audience/:profanity",function(e,o){switch(console.log("got here"),console.log("audience "+e.params.audience),query={kids:!0},Number(e.params.audience)){case 0:query={men:!0},console.log("men");break;case 1:query={women:!0},console.log("women");break;case 2:query={kids:!0},console.log("kids")}var r=JSON.parse(e.params.profanity);r?query={$or:[query,{profanity:r}]}:query.profanity=!1,query.approved=!0,console.log(query),Lines.find(query,function(e,r){console.log("query returned "+r.length),o.json(r)})}),router.post("/add",function(e,o){console.log("add called");var r=e.body;r.ipaddress=e.headers["x-forwarded-for"]||e.connection.remoteAddress||e.socket.remoteAddress||e.connection.socket.remoteAddress,console.log(r),banlist.count({ipaddress:r.ipaddress},function(e,n){console.log("ipaddresscount : "+n),n>0?console.error("Banned IP tried to create record"):(console.log("adding record "+r),Lines.create(r,function(e,r){console.log("err:"+e),console.log("result:"+r),sendJSONresponse(o,200,r)}))})}),router.get("/rate/:lineid/:vote",function(e,o){console.log("vote called"),Lines.findById(e.params.lineid).exec(function(r,n){"true"===e.params.vote?n.rating++:n.rating--,n.save(function(e,r){sendJSONresponse(o,200,r)})})});var sendJSONresponse=function(e,o,r){e.status(o),e.json(r)};module.exports=router;